{% extends "StudiiFezabilitate/base.html" %}

{% block body %}

<h3 class="text-center m-4">Editează lucrarea</h3>
{% if success %}
<div class="alert alert-success" role="alert">
    Lucrarea a fost editată cu succes!
    <a href="{% url 'index' %}" class="alert-link">Mergi la pagina principală.</a>
</div>
{% else %}
<div class="row justify-content-center">
    <div class="col-6">
        <div class="card bg-light mb-3">
            <div class="card-header">
                <i class="fa-solid fa-pen-to-square fa-lg"></i> Editează lucrarea
            </div>
            <div class="card-body">
                <form action="" method="POST">
                    {% csrf_token %}
                    {{form.as_p}}
                    <button type="submit" class="btn btn-primary">Editează</button>
                    <a href="{% url 'index' %}" class="btn btn-secondary">Anulează</a>
                </form>
            </div>
        </div>
    </div>
</div>

{% endif %}
{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const judetSelect = document.getElementById('id_judet');
    const localitateSelect = document.getElementById('id_localitate');
    
    // Funcție pentru a încărca localitățile în funcție de județ
    function loadLocalitati(judetId, selectedLocalitateId = null) {
        // Golește dropdown-ul existent
        localitateSelect.innerHTML = '<option value="">---------</option>';
        
        if (!judetId) return;
        
        // Solicită localitățile pentru județul selectat
        fetch(`{% url 'get_localitati' %}?judet_id=${judetId}`)
            .then(response => response.json())
            .then(data => {
                // Adaugă opțiunile la dropdown
                data.forEach(localitate => {
                    const option = document.createElement('option');
                    option.value = localitate.id;
                    option.textContent = localitate.text;
                    
                    // Selectează valoarea inițială dacă există
                    if (selectedLocalitateId && localitate.id == selectedLocalitateId) {
                        option.selected = true;
                    }
                    
                    localitateSelect.appendChild(option);
                });
            });
    }
    
    // La schimbarea județului, încarcă localitățile corespunzătoare
    judetSelect.addEventListener('change', function() {
        loadLocalitati(this.value);
    });
    
    // Încarcă localitățile inițiale dacă există un județ selectat
    if (judetSelect.value) {
        const initialLocalitateId = localitateSelect.value;
        loadLocalitati(judetSelect.value, initialLocalitateId);
    }
});
</script>
{% endblock %}
{% endblock %}